{% extends "base.html" %}

{% block title %}我接的单子 - AI创造互助社区{% endblock %}

{% block content %}
<div class="my-orders-page">
    <div class="page-header">
        <h1>我接的单子</h1>
        <a href="/posts" class="btn-outline">浏览更多求助</a>
    </div>

    <!-- 进行中的单子 -->
    <div class="card section">
        <h2 class="section-title">进行中 ({{ in_progress|length }})</h2>
        {% if in_progress %}
        <div class="orders-list">
            {% for order in in_progress %}
            <a href="/posts/{{ order.posts.id if order.posts else order.post_id }}" class="order-item">
                <div class="order-main">
                    <span class="order-title">{{ order.posts.title if order.posts else '未知帖子' }}</span>
                    {% if order.status == 'pending_review' %}
                    <span class="order-status status-pending-review">审核中</span>
                    {% else %}
                    <span class="order-status status-accepted">进行中</span>
                    {% endif %}
                </div>
                <div class="order-meta">
                    <span class="order-time">接单时间: {{ order.created_at[:10] if order.created_at else '' }}</span>
                </div>
            </a>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <p>暂无进行中的单子</p>
            <a href="/posts" class="btn-primary">去接单</a>
        </div>
        {% endif %}
    </div>

    <!-- 已完成的单子 -->
    <div class="card section">
        <h2 class="section-title">已完成 ({{ completed|length }})</h2>
        {% if completed %}
        <div class="orders-list">
            {% for order in completed %}
            <a href="/posts/{{ order.posts.id if order.posts else order.post_id }}" class="order-item completed">
                <div class="order-main">
                    <span class="order-title">{{ order.posts.title if order.posts else '未知帖子' }}</span>
                    <span class="order-status status-completed">已完成</span>
                </div>
                <div class="order-meta">
                    <span class="order-time">完成时间: {{ order.updated_at[:10] if order.updated_at else order.created_at[:10] if order.created_at else '' }}</span>
                </div>
            </a>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <p>暂无已完成的单子</p>
        </div>
        {% endif %}
    </div>
</div>

<style>
.my-orders-page {
    max-width: 900px;
    margin: 0 auto;
    width: 100%;
}

.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
}

.page-header h1 {
    margin: 0;
}

.section {
    padding: 1.5rem;
    margin-bottom: 1.5rem;
}

.section-title {
    font-size: 1.125rem;
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid var(--border-color);
}

.orders-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.order-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background: var(--bg-secondary);
    border-radius: var(--border-radius);
    text-decoration: none;
    color: inherit;
    transition: all 0.2s;
}

.order-item:hover {
    background: var(--bg-tertiary, #e5e7eb);
    transform: translateX(4px);
}

.order-item.completed {
    opacity: 0.7;
}

.order-main {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex: 1;
    min-width: 0;
}

.order-title {
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.order-status {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    white-space: nowrap;
}

.status-accepted {
    background: #dbeafe;
    color: #1e40af;
}

.status-completed {
    background: #d1fae5;
    color: #065f46;
}

.status-pending-review {
    background: #fef3c7;
    color: #92400e;
}

.order-meta {
    font-size: 0.875rem;
    color: var(--text-muted);
}

.empty-state {
    text-align: center;
    padding: 2rem;
    color: var(--text-muted);
}

.empty-state p {
    margin-bottom: 1rem;
}

@media (max-width: 640px) {
    .page-header {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
    }

    .order-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
    }
}
</style>
{% endblock %}
