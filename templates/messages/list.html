{% extends "base.html" %}

{% block title %}æ¶ˆæ¯é€šçŸ¥ - AIç”Ÿæˆç¤¾åŒº{% endblock %}

{% block content %}
<div class="messages-page">
    <header class="page-header">
        <h1>æ¶ˆæ¯é€šçŸ¥</h1>
        {% if messages %}
        <button class="btn-outline"
                hx-post="/messages/read-all"
                hx-swap="none"
                hx-on::after-request="location.reload()">
            å…¨éƒ¨æ ‡è®°å·²è¯»
        </button>
        {% endif %}
    </header>

    {% if messages %}
    <div class="messages-list card">
        {% for message in messages %}
        <div class="message-item-full {% if not message.is_read %}unread{% endif %}">
            <div class="message-icon">
                {% if message.message_type == 'order' %}
                <span>ğŸ“¦</span>
                {% elif message.message_type == 'system' %}
                <span>ğŸ””</span>
                {% else %}
                <span>ğŸ’¬</span>
                {% endif %}
            </div>
            <div class="message-body">
                <div class="message-header-row">
                    <h3 class="message-title">{{ message.title }}</h3>
                    <span class="message-time">{{ message.created_at[:16].replace('T', ' ') }}</span>
                </div>
                <div class="message-content">{{ message.content }}</div>
                {% if message.related_post_id %}
                <div class="message-actions">
                    <a href="/posts/{{ message.related_post_id }}" class="btn-outline btn-small">æŸ¥çœ‹å¸–å­</a>
                </div>
                {% endif %}
            </div>
            {% if not message.is_read %}
            <button class="mark-read-btn"
                    hx-post="/messages/{{ message.id }}/read"
                    hx-swap="outerHTML"
                    hx-target="closest .message-item-full"
                    title="æ ‡è®°å·²è¯»">
                <span>âœ“</span>
            </button>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    {% if total_pages > 1 %}
    <nav class="pagination">
        {% if page > 1 %}
        <a href="/messages?page={{ page - 1 }}" class="btn-outline">ä¸Šä¸€é¡µ</a>
        {% endif %}
        <span class="page-info">ç¬¬ {{ page }} / {{ total_pages }} é¡µ</span>
        {% if page < total_pages %}
        <a href="/messages?page={{ page + 1 }}" class="btn-outline">ä¸‹ä¸€é¡µ</a>
        {% endif %}
    </nav>
    {% endif %}

    {% else %}
    <div class="empty-state card">
        <div class="empty-icon">ğŸ“­</div>
        <h3>æš‚æ— æ¶ˆæ¯</h3>
        <p>æ‚¨è¿˜æ²¡æœ‰æ”¶åˆ°ä»»ä½•æ¶ˆæ¯</p>
    </div>
    {% endif %}
</div>

<style>
.messages-page {
    max-width: 800px;
    margin: 0 auto;
}

.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.page-header h1 {
    margin: 0;
}

.messages-list {
    padding: 0;
    overflow: hidden;
}

.message-item-full {
    display: flex;
    gap: 1rem;
    padding: 1.25rem;
    border-bottom: 1px solid var(--border-color);
    position: relative;
}

.message-item-full:last-child {
    border-bottom: none;
}

.message-item-full.unread {
    background: #f0f4ff;
}

.message-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
}

.message-body {
    flex: 1;
    min-width: 0;
}

.message-header-row {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;
    margin-bottom: 0.5rem;
}

.message-title {
    font-size: 1rem;
    font-weight: 600;
    margin: 0;
}

.message-time {
    font-size: 0.8rem;
    color: var(--text-muted);
    flex-shrink: 0;
}

.message-content {
    font-size: 0.9rem;
    color: var(--text-color);
    line-height: 1.6;
    white-space: pre-wrap;
}

.message-actions {
    margin-top: 0.75rem;
}

.btn-small {
    font-size: 0.8rem;
    padding: 0.25rem 0.75rem;
}

.mark-read-btn {
    position: absolute;
    top: 1rem;
    right: 1rem;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    border: 1px solid var(--border-color);
    background: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    color: var(--text-muted);
    transition: all 0.2s;
}

.mark-read-btn:hover {
    background: var(--primary-color);
    border-color: var(--primary-color);
    color: white;
}

.empty-state {
    text-align: center;
    padding: 3rem;
}

.empty-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}

.empty-state h3 {
    margin-bottom: 0.5rem;
}

.empty-state p {
    color: var(--text-muted);
}

.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    margin-top: 1.5rem;
}

.page-info {
    color: var(--text-muted);
}
</style>
{% endblock %}
