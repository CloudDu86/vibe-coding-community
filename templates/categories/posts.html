{% extends "base.html" %}

{% block title %}{{ category.name }} - Vibe Codingäº’åŠ©ç¤¾åŒº{% endblock %}

{% block content %}
<div class="category-posts-page">
    <div class="page-header">
        <nav class="breadcrumb">
            <a href="/categories">é¡¹ç›®åˆ†ç±»</a>
            <span class="separator">/</span>
            <span class="current">{{ category.name }}</span>
        </nav>
        <h1>
            <span class="category-icon">
                {% if category.slug == 'web' %}ğŸŒ
                {% elif category.slug == 'app' %}ğŸ“±
                {% elif category.slug == 'wechat-mini' %}ğŸ’¬
                {% elif category.slug == 'desktop' %}ğŸ–¥ï¸
                {% elif category.slug == 'backend' %}âš™ï¸
                {% elif category.slug == 'ai-ml' %}ğŸ¤–
                {% else %}ğŸ“{% endif %}
            </span>
            {{ category.name }}
        </h1>
        {% if category.description %}
        <p class="category-desc">{{ category.description }}</p>
        {% endif %}
        <p class="post-count">å…± {{ total }} æ¡æ±‚åŠ©</p>
    </div>

    <div class="page-content">
        <aside class="filters-sidebar">
            <div class="card filters-card">
                <h3 class="filter-title">ç­›é€‰æ¡ä»¶</h3>

                <form hx-get="/categories/{{ category.slug }}"
                      hx-target="#posts-container"
                      hx-swap="innerHTML"
                      hx-trigger="change"
                      class="filter-form">
                    <div class="form-group">
                        <label class="form-label">çŠ¶æ€</label>
                        <select name="status" class="form-select">
                            <option value="">å…¨éƒ¨çŠ¶æ€</option>
                            <option value="open" {% if current_status == 'open' %}selected{% endif %}>å¾…è§£å†³</option>
                            <option value="in_progress" {% if current_status == 'in_progress' %}selected{% endif %}>è¿›è¡Œä¸­</option>
                            <option value="resolved" {% if current_status == 'resolved' %}selected{% endif %}>å·²è§£å†³</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ç´§æ€¥ç¨‹åº¦</label>
                        <select name="urgency" class="form-select">
                            <option value="">å…¨éƒ¨</option>
                            <option value="urgent" {% if current_urgency == 'urgent' %}selected{% endif %}>ç´§æ€¥</option>
                            <option value="high" {% if current_urgency == 'high' %}selected{% endif %}>è¾ƒæ€¥</option>
                            <option value="medium" {% if current_urgency == 'medium' %}selected{% endif %}>ä¸€èˆ¬</option>
                            <option value="low" {% if current_urgency == 'low' %}selected{% endif %}>ä¸æ€¥</option>
                        </select>
                    </div>

                    <a href="/categories/{{ category.slug }}" class="btn-outline btn-reset">é‡ç½®ç­›é€‰</a>
                </form>
            </div>

            <div class="card action-card">
                <p>åœ¨ {{ category.name }} åˆ†ç±»ä¸‹å‘å¸ƒæ±‚åŠ©</p>
                <a href="/posts/create?category={{ category.slug }}" class="btn-primary">å‘å¸ƒæ±‚åŠ©</a>
            </div>
        </aside>

        <main id="posts-container" class="posts-main">
            {% if posts %}
            <div class="posts-list">
                {% for post in posts %}
                {% include "posts/partials/post_card.html" %}
                {% endfor %}
            </div>

            {% if total_pages > 1 %}
            <div class="pagination">
                {% if page > 1 %}
                <a href="/categories/{{ category.slug }}?page={{ page - 1 }}{% if current_status %}&status={{ current_status }}{% endif %}{% if current_urgency %}&urgency={{ current_urgency }}{% endif %}"
                   class="btn-outline">
                    ä¸Šä¸€é¡µ
                </a>
                {% endif %}

                <span class="page-info">ç¬¬ {{ page }} / {{ total_pages }} é¡µ</span>

                {% if page < total_pages %}
                <a href="/categories/{{ category.slug }}?page={{ page + 1 }}{% if current_status %}&status={{ current_status }}{% endif %}{% if current_urgency %}&urgency={{ current_urgency }}{% endif %}"
                   class="btn-outline">
                    ä¸‹ä¸€é¡µ
                </a>
                {% endif %}
            </div>
            {% endif %}

            {% else %}
            <div class="empty-state card">
                <div class="empty-state-icon">ğŸ“­</div>
                <h3>æš‚æ— æ±‚åŠ©å¸–å­</h3>
                <p>è¯¥åˆ†ç±»ä¸‹è¿˜æ²¡æœ‰æ±‚åŠ©å¸–å­ï¼Œæˆä¸ºç¬¬ä¸€ä¸ªå‘å¸ƒè€…å§ï¼</p>
                <a href="/posts/create" class="btn-primary">å‘å¸ƒæ±‚åŠ©</a>
            </div>
            {% endif %}
        </main>
    </div>
</div>

<style>
.category-posts-page {
    max-width: 1200px;
    margin: 0 auto;
    width: 100%;
}

.page-header {
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid var(--border-color);
}

.breadcrumb {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
    font-size: 0.875rem;
}

.breadcrumb a {
    color: var(--primary-color);
    text-decoration: none;
}

.breadcrumb a:hover {
    text-decoration: underline;
}

.breadcrumb .separator {
    color: var(--text-muted);
}

.breadcrumb .current {
    color: var(--text-muted);
}

.page-header h1 {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.5rem;
}

.category-icon {
    font-size: 2rem;
}

.category-desc {
    color: var(--text-muted);
    margin-bottom: 0.5rem;
}

.post-count {
    color: var(--text-muted);
    font-size: 0.9rem;
}

.page-content {
    display: grid;
    grid-template-columns: 280px 1fr;
    gap: 2rem;
}

.filters-sidebar {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.filters-card {
    position: sticky;
    top: 100px;
}

.filter-title {
    font-size: 1rem;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--border-color);
}

.filter-form .form-group {
    margin-bottom: 1rem;
}

.btn-reset {
    width: 100%;
    text-align: center;
    display: block;
    margin-top: 1rem;
}

.action-card {
    text-align: center;
}

.action-card p {
    color: var(--text-muted);
    margin-bottom: 1rem;
    font-size: 0.9rem;
}

.action-card .btn-primary {
    width: 100%;
}

.posts-main {
    min-height: 400px;
}

.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    margin-top: 2rem;
    padding-top: 1rem;
    border-top: 1px solid var(--border-color);
}

.page-info {
    color: var(--text-muted);
}

.empty-state {
    text-align: center;
    padding: 4rem 2rem;
}

.empty-state h3 {
    margin: 1rem 0 0.5rem;
}

.empty-state p {
    color: var(--text-muted);
    margin-bottom: 1.5rem;
}

@media (max-width: 900px) {
    .page-content {
        grid-template-columns: 1fr;
    }

    .filters-sidebar {
        order: 2;
    }

    .posts-main {
        order: 1;
    }

    .filters-card {
        position: static;
    }
}
</style>
{% endblock %}
